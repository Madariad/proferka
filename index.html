<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Реакция на букву 'a'</title>
</head>
<body>
    <h1>Реакция на букву 'a'</h1>
    <div id="volume">Громкость: ...</div>
    <div id="letter">Буква: ...</div>
    <div class="">4</div>

    <script>

        window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

        const recognition = new SpeechRecognition();
        recognition.interimResults = true;
        console.log(recognition);


        recognition.addEventListener("result", (e) => {
        
            console.log('sd');
        const text = Array.from(e.results)
            .map((result) => result[0])
            .map((result) => result.transcript)
            .join("");


            document.getElementById('letter').textContent = 'Буква: ' + text;

        
        });

        // recognition.addEventListener("end", () => {
        // recognition.start();
        // });

        recognition.start();




    

        // Запрашиваем доступ к микрофону
        navigator.mediaDevices.getUserMedia({ audio: true, video: false })
          .then((stream) => {
            const audioContext = new AudioContext();
            const analyser = audioContext.createAnalyser();
            const microphone = audioContext.createMediaStreamSource(stream);
            microphone.connect(analyser);
            analyser.fftSize = 256;
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);

            // Функция для обновления громкости
            function updateVolume() {
              analyser.getByteFrequencyData(dataArray);

              // Вычисляем среднюю громкость
              let sum = 0;
              for(let i = 0; i < bufferLength; i++) {
                sum += dataArray[i];
              }
              let averageVolume = sum / bufferLength;

              // Обновляем значение громкости на странице
              document.getElementById('volume').textContent = 'Громкость: ' + averageVolume;

              // Повторяем функцию каждые 100 миллисекунд
              setTimeout(updateVolume, 100);
            }

            // Запускаем функцию обновления громкости
            updateVolume();
          })
          .catch((error) => {
            console.error('Ошибка при получении медиа-потока:', error);
          });
          
      
    </script>
</body>
</html>
